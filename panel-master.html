<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>RIFAS MASTER - Crear Nueva Rifa</title>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC_YFwpvNIQPIFUsjtfSxuV45r7Hxuvh7E",
      authDomain: "rifasmaster.firebaseapp.com",
      projectId: "rifasmaster",
      storageBucket: "rifasmaster.appspot.com",
      messagingSenderId: "441338254596",
      appId: "1:441338254596:web:c0e39d99789d193ee6ec51"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let cuentas = [];

    function agregarCuenta() {
      const banco = document.getElementById("bancoTemp").value.trim();
      const cuenta = document.getElementById("cuentaTemp").value.trim();
      const clabe = document.getElementById("clabeTemp").value.trim();
      const beneficiario = document.getElementById("benefTemp").value.trim();

      if (!banco || !cuenta || !beneficiario) {
        alert("Completa todos los campos de la cuenta.");
        return;
      }

      cuentas.push({ banco, cuenta, clabe, beneficiario });
      actualizarListaCuentas();

      document.getElementById("bancoTemp").value = "";
      document.getElementById("cuentaTemp").value = "";
      document.getElementById("clabeTemp").value = "";
      document.getElementById("benefTemp").value = "";
    }

    function actualizarListaCuentas() {
      const lista = document.getElementById("listaCuentas");
      lista.innerHTML = cuentas.map((c, i) =>
        `${i + 1}. ${c.banco} - ${c.cuenta} (${c.beneficiario})`
      ).join("<br>");
    }

    async function crearRifa() {
      const nombreRifa = document.getElementById("nombreRifa").value.trim();
      const cantidadBoletos = parseInt(document.getElementById("cantidadBoletos").value);
      const precioBoleto = parseFloat(document.getElementById("precioBoleto").value);
      const premios = document.getElementById("premios").value.trim();
      const activarTombola = document.getElementById("tombola").checked;

      if (!nombreRifa || !cantidadBoletos || !precioBoleto) {
        alert("Por favor completa todos los campos obligatorios.");
        return;
      }

      await addDoc(collection(db, "rifas"), {
        nombreRifa,
        cantidadBoletos,
        precioBoleto,
        cuentasBancarias: cuentas,
        premios,
        activarTombola,
        fechaCreacion: new Date()
      });

      alert("✅ Rifa creada correctamente");
    }

    window.crearRifa = crearRifa;
  </script>
</head>

<body>
  <h1>Crear Nueva Rifa</h1>

  <label>Nombre de la Rifa:</label><br>
  <input type="text" id="nombreRifa"><br><br>

  <label>Cantidad de Boletos:</label><br>
  <input type="number" id="cantidadBoletos"><br><br>

  <label>Precio por Boleto:</label><br>
  <input type="number" id="precioBoleto"><br><br>

  <label>Premios:</label><br>
  <input type="text" id="premios" placeholder="Ej: 1er, 2do, 3er lugar"><br><br>

  <label>Activar Tómbola Aleatoria:</label>
  <input type="checkbox" id="tombola"><br><br>

  <h3>Cuentas Bancarias:</h3>
  <div id="listaCuentas"></div>
  <input type="text" id="bancoTemp" placeholder="Banco"><br>
  <input type="text" id="cuentaTemp" placeholder="Cuenta"><br>
  <input type="text" id="clabeTemp" placeholder="CLABE"><br>
  <input type="text" id="benefTemp" placeholder="Beneficiario"><br>
  <button type="button" onclick="agregarCuenta()">Agregar Cuenta</button><br><br>

  <button onclick="crearRifa()">Crear Rifa</button>
</body>
</html>
